!function(t){t.fn.tweetMachine=function(e,i,a){t(this).each(function(){var n,r;this.tweetMachine?(n=t.extend(this.tweetMachine.settings,i),this.tweetMachine.settings=n,e&&(this.tweetMachine.query=e),this.tweetMachine.interval&&this.tweetMachine.refresh(),a&&(this.tweetMachine.callback=a)):(n=t.extend({backendScript:"ajax/getFromTwitter.php",endpoint:"search/tweets",user_name:"jason_alvis",include_retweets:!0,exclude_replies:!1,rate:5e3,limit:5,autoRefresh:!0,animateOut:!1,animateIn:!0,tweetFormat:"<li><p class='content'></p><b><a href='' class='time'></a></b></li>",localization:{seconds:"seconds ago",minute:"a minute ago",minutes:"minutes ago",hour:"an hour ago",hours:"hours ago",day:"a day ago",days:"days ago"},filter:!1},i),this.tweetMachine={settings:n,query:e,interval:!1,container:this,lastTweetID:null,callback:a,relativeTime:function(t){var e,i,a;return i=Date.parse(t),e=(Date.parse(Date())-i)/1e3,a="",a=e<60?e+" "+n.localization.seconds:e<120?n.localization.minute:e<2700?parseInt(e/60,10).toString()+" "+n.localization.minutes:e<5400?n.localization.hour:e<86400?""+parseInt(e/3600,10).toString()+" "+n.localization.hours:e<172800?n.localization.day:parseInt(e/86400,10).toString()+" "+n.localization.days},updateTimestamps:function(){var e;e=this,t(e.container).find(".time").each(function(){var i,a;i=(a=t(this)).data("timestamp"),a.html(e.relativeTime(i))})},parseText:function(t){return t=(t=(t=t.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&\?\/.=]+/g,function(t){return'<a href="'+t+'" target="_blank">'+t+"</a>"})).replace(/@[A-Za-z0-9_]+/g,function(t){return'<a href="https://twitter.com/#!/'+t.replace(/^@/,"")+'" target="_blank">'+t+"</a>"})).replace(/#[A-Za-z0-9_\-]+/g,function(t){return'<a href="https://twitter.com/#!/search?q='+t.replace(/^#/,"%23")+'" target="_blank">'+t+"</a>"})},buildTweet:function(e){var i,a;return i=this,(a=t(i.settings.tweetFormat)).find(".avatar").attr("src",e.user.profile_image_url.replace("normal","reasonably_small")),a.find(".username").attr("href","https://twitter.com/"+e.user.screen_name).attr("target","_blank").html(""+e.user.screen_name),a.find(".time").attr("href","https://twitter.com/"+e.user.screen_name+"/status/"+e.id_str).attr("target","_blank").html(i.relativeTime(e.created_at)).data("timestamp",e.created_at),a.find(".content").html(i.parseText(e.text)),i.settings.animateIn&&a.css("opacity","0"),a},refresh:function(e){var i,a;a=this,(e||a.settings.autoRefresh)&&("search/tweets"===a.settings.endpoint&&(i={q:a.query,count:this.settings.requestLimit?this.settings.requestLimit:this.settings.limit,since_id:a.lastTweetID}),"statuses/user_timeline"===a.settings.endpoint&&(i={screen_name:n.user_name,count:this.settings.requestLimit?this.settings.requestLimit:this.settings.limit,include_rts:n.include_retweets,exclude_replies:n.exclude_replies}),t.getJSON(a.settings.backendScript,{endpoint:a.settings.endpoint,queryParams:i},function(i){var n;i[0]&&(i[0].message?t(".twitter-error").length?t(".twitter-error").html('<p class="tweet-machine-error">Error  '+i[0].code+": "+i[0].message+"</p>"):t(a.container).before('<p class="twitter-error">Error  '+i[0].code+": "+i[0].message+"</p>"):(t(".twitter-error").length&&t(".twitter-error").remove(),i.reverse(),n=0,t.each(i,function(){var i,r;if(i=this,(!a.settings.filter||a.settings.filter(this))&&(r=a.buildTweet(i),!e&&(a.settings.animateOut||t(a.container).children(":last-child").remove()),t(a.container).prepend(r),a.settings.animateIn&&t(a.container).children(":first-child").animate({opacity:1}),n++,a.lastTweetID=i.id_str,n>a.settings.limit))return!1}))),"function"==typeof a.callback&&((void 0===i||void 0===n)&&(i=null,n=0),a.callback(i,n))}))},start:function(){var t;t=this,this.interval||(this.interval=setInterval(function(){t.refresh()},t.settings.rate),this.refresh(!0))},stop:function(){var t;t=this,t.interval&&(clearInterval(t.interval),t.interval=!1)},clear:function(){var e;e=this,t(e.container).find(".tweet").remove(),e.lastTweetID=null}},r=this.tweetMachine,this.timeInterval=setInterval(function(){r.updateTimestamps()},r.settings.rate),this.tweetMachine.start())})}}(jQuery);